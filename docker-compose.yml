version: '3.8'

services:
  siscom-consumer:
    build: .
    container_name: siscom-consumer-dev
    volumes:
      - ./logs:/var/log/siscom-consumer
    environment:
      # Logging
      - RUST_LOG=info
      - RUST_BACKTRACE=1
      # MQTT/Broker Configuration
      - BROKER_HOST=${BROKER_HOST:-}
      - BROKER_TOPIC=${BROKER_TOPIC:-}
      - BROKER_TYPE=mqtt
      - MQTT_USERNAME=${MQTT_USERNAME:-}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-}
      - MQTT_CLIENT_ID=siscom-consumer-dev
      - MQTT_KEEP_ALIVE_SECS=60
      - MQTT_CLEAN_SESSION=true
      - MQTT_MAX_RECONNECT_ATTEMPTS=10
      # Kafka Configuration
      - KAFKA_ENABLED=false
      - KAFKA_BROKERS=kafka:9092
      - KAFKA_POSITION_TOPIC=position-topic
      - KAFKA_NOTIFICATIONS_TOPIC=notifications-topic
      - KAFKA_BATCH_SIZE=100
      - KAFKA_BATCH_TIMEOUT_MS=100
      - KAFKA_COMPRESSION=snappy
      - KAFKA_RETRIES=3
      # Database Configuration
      - DB_HOST=postgres
      - DB_PORT=5432
      - DB_DATABASE=tracking
      - DB_USERNAME=user
      - DB_PASSWORD=password
      - DB_MAX_CONNECTIONS=20
      - DB_MIN_CONNECTIONS=5
      - DB_CONNECTION_TIMEOUT_SECS=30
      - DB_IDLE_TIMEOUT_SECS=600
      # Processing Configuration
      - PROCESSING_WORKER_THREADS=4
      - PROCESSING_MESSAGE_BUFFER_SIZE=10000
      - PROCESSING_BATCH_PROCESSING_SIZE=100
      - PROCESSING_MAX_PARALLEL_DEVICES=50
      # Logging Configuration (additional)
      - LOGGING_FILE_PATH=/var/log/siscom-consumer/app.log
      - LOGGING_MAX_FILE_SIZE_MB=100
      - LOGGING_MAX_FILES=10
      - LOGGING_JSON_FORMAT=true
    depends_on:
      - postgres
      - kafka
    networks:
      - siscom-network

volumes:
  postgres_data:

networks:
  siscom-network:
    driver: bridge